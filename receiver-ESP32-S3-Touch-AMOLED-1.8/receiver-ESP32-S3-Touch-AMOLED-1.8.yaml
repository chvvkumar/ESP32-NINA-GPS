esphome:
  name: amoled
  friendly_name: AMOLED
  on_boot:
    priority: 600
    then:
      - delay: 2s
      - lambda: |-
          // Initialize activity timer
          id(last_activity_time) = millis();
      - lambda: |-
          // Update receiver IP address on display
          auto ip_str = id(wifi_ip_address).state;
          lv_label_set_text(id(value_receiver_ip), ip_str.c_str());

          // Initialize bar range from history for all pages
          int max_hist = (int)id(gps_max_sats).state;
          if (max_hist < 10) max_hist = 24; 
          lv_bar_set_range(id(lbl_sats_canvas1), 0, max_hist);
          lv_obj_invalidate(id(lbl_sats_canvas1));
          lv_bar_set_range(id(lbl_sats_canvas2), 0, max_hist);
          lv_obj_invalidate(id(lbl_sats_canvas2));
          // lv_bar_set_range(id(lbl_sats_canvas3), 0, max_hist);
          // lv_obj_invalidate(id(lbl_sats_canvas3));
          // lv_bar_set_range(id(lbl_sats_canvas4), 0, max_hist);
          // lv_obj_invalidate(id(lbl_sats_canvas4));

      # Restore the last displayed LVGL page
      - delay: 500ms
      - if:
          condition:
            lambda: 'return id(display_page).has_state() && id(display_page).current_option() == "Home";'
          then:
            - lvgl.page.show: canvas_1
      - if:
          condition:
            lambda: 'return id(display_page).has_state() && id(display_page).current_option() == "GPS Accuracy";'
          then:
            - lvgl.page.show: canvas_2
      - if:
          condition:
            lambda: 'return id(display_page).has_state() && id(display_page).current_option() == "Speed";'
          then:
            - lvgl.page.show: canvas_3
      - if:
          condition:
            lambda: 'return id(display_page).has_state() && id(display_page).current_option() == "Network Info";'
          then:
            - lvgl.page.show: canvas_4

esp32:
  variant: esp32s3
  framework:
    type: esp-idf
    # Add optimization flags for performance
    sdkconfig_options:
      COMPILER_OPTIMIZATION_SIZE: y
      COMPILER_OPTIMIZATION_LEVEL_RELEASE: y
      CONFIG_COMPILER_OPTIMIZATION_ASSERTIONS_DISABLE: y
      CONFIG_HEAP_POISONING_DISABLED: y
  flash_size: 16MB

# Enable logging
logger:
  level: WARN  # Changed from DEBUG (default) to WARN to save CPU

# debug:  # Removed debug component to save resources
#   update_interval: 5s

# Enable Home Assistant API
api:
  encryption:
    key: "w32Msmy93F1ixn76Ywdas9UVNLr8kT9A7MrYJxGsmBg="

ota:
  - platform: esphome
    password: "7ed0db7a69c73d2a32cafdcb113e8f3e"

wifi:
  ssid: IoT
  password: kkkkkkkk
  power_save_mode: none
  on_connect:
    - lambda: |-
        // Update WiFi MAC text sensor on connection
        uint8_t mac_bytes[6];
        esp_read_mac(mac_bytes, ESP_MAC_WIFI_STA);
        char mac_str[18];
        snprintf(mac_str, sizeof(mac_str), "%02X:%02X:%02X:%02X:%02X:%02X",
                 mac_bytes[0], mac_bytes[1], mac_bytes[2], mac_bytes[3], mac_bytes[4], mac_bytes[5]);
        id(wifi_mac_address).publish_state(mac_str);
  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Amoled Fallback Hotspot"
    password: "kkkkkkkk"

captive_portal:

web_server:
  port: 80
  version: 3
  include_internal: true

psram:
  mode: octal

i2c:
  id: i2c_1
  scl: GPIO14
  sda: GPIO15
  scan: true
  frequency: 100kHz

# =============================================
# PCA9554 GPIO Expander for buttons (XCA9554 compatible)
# =============================================
pca9554:
  - id: xca9554_hub
    address: 0x20

spi:
  type: quad
  clk_pin: GPIO11
  data_pins: [GPIO4, GPIO5, GPIO6, GPIO7]

# =============================================
# Interval - Display Sleep Monitor
# =============================================
interval:
  - interval: 1s
    then:
      - lambda: |-
          // Check if display should sleep
          float timeout = id(display_sleep_timeout).state;
          
          // Skip if timeout is 0 (disabled)
          if (timeout <= 0) {
            return;
          }
          
          // Skip if already sleeping
          if (id(display_sleeping)) {
            return;
          }
          
          // Check if timeout exceeded
          uint32_t now = millis();
          uint32_t elapsed = (now - id(last_activity_time)) / 1000;  // Convert to seconds
          
          if (elapsed >= (uint32_t)timeout) {
            // Put display to sleep
            id(display_sleeping) = true;
            id(amoled_display).set_brightness(0);
            ESP_LOGI("sleep", "Display going to sleep after %d seconds of inactivity", (int)timeout);
          }

# =============================================
# Button
# =============================================
button:
  - platform: restart
    name:  "Reboot"
    internal: false

# =============================================
# Binary Sensors - Side Buttons
# =============================================
binary_sensor:
  - platform: gpio
    id: button_brightness
    name: "Brightness Cycle Button"
    internal: false
    pin:
      pca9554: xca9554_hub
      number: 4
      mode: INPUT
      inverted: true
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    on_press:
      then:
        - lambda: |-
            // Reset sleep timer
            id(last_activity_time) = millis();
            
            // Wake display if sleeping
            if (id(display_sleeping)) {
              id(display_sleeping) = false;
              float brightness = id(display_brightness).state;
              id(amoled_display).set_brightness((brightness - 10) * 2.8333);
              ESP_LOGI("sleep", "Display woken by brightness button");
              return;  // Don't change brightness on wake, just wake up
            }
            
            // Cycle through brightness: 0%, 20%, 40%, 60%, 80%, 100%
            float current = id(display_brightness).state;
            float next_brightness;
            
            if (current <= 10) {
              next_brightness = 30;  // 0% -> 20%
            } else if (current <= 30) {
              next_brightness = 50;  // 20% -> 40%
            } else if (current <= 50) {
              next_brightness = 70;  // 40% -> 60%
            } else if (current <= 70) {
              next_brightness = 90;  // 60% -> 80%
            } else if (current <= 90) {
              next_brightness = 100; // 80% -> 100%
            } else {
              next_brightness = 10;  // 100% -> 0%
            }
            
            id(display_brightness).publish_state(next_brightness);
            ESP_LOGI("brightness", "Cycling brightness from %.0f to %.0f", current, next_brightness);

  - platform: gpio
    id: button_next
    name: "Next Page Button"
    internal: false
    pin:
      number: GPIO0
      mode:
        input: true
        pullup: true
      inverted: true
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    on_press:
      then:
        - lambda: |-
            // Reset sleep timer
            id(last_activity_time) = millis();
            
            // Wake display if sleeping
            if (id(display_sleeping)) {
              id(display_sleeping) = false;
              float brightness = id(display_brightness).state;
              id(amoled_display).set_brightness((brightness - 10) * 2.8333);
              ESP_LOGI("sleep", "Display woken by next page button");
              return;  // Don't change page on wake, just wake up
            }
            
            // Cycle to next page
            auto current_page = id(display_page).current_option();
            ESP_LOGI("button", "Next button pressed, current page: %s", current_page);
            if (current_page == "Home") {
              id(display_page).publish_state("GPS Accuracy");
            } else if (current_page == "GPS Accuracy") {
              id(display_page).publish_state("Speed");
            } else if (current_page == "Speed") {
              id(display_page).publish_state("Network Info");
            } else if (current_page == "Network Info") {
              id(display_page).publish_state("Home");
            }

# =========================================================================
#  ESP-NOW CONFIGURATION
# =========================================================================
espnow:
  id: espnow_component
  auto_add_peer: true
  peers:
    - "10:B4:1D:EA:E0:68"
    - "B4:3A:45:99:70:80"
  on_unknown_peer:
    - lambda: |-
        // Update ESP-NOW MAC when peer is added
        uint8_t mac[6];
        esp_read_mac(mac, ESP_MAC_WIFI_STA);
        char mac_str[18];
        snprintf(mac_str, sizeof(mac_str), "%02X:%02X:%02X:%02X:%02X:%02X",
                 mac[0], mac[1], mac[2], mac[3], mac[4], mac[5]);
        id(espnow_mac_address).publish_state(mac_str);
  
  on_receive:
    - lambda: |-
        // Blink LED when data arrives
        lv_led_on(id(lv_led_7));
        
        struct __attribute__((packed)) GpsEspNowPacket {
          double lat;
          double lon;
          float alt;
          float speed;
          float heading;
          uint8_t sats;
          uint8_t satsVisible;
          uint8_t fixType;
          char localTime[10];
          float pdop;
          float hdop;
          float vdop;
          float hAcc;
          float vAcc;
          uint32_t stationIp;
          uint32_t pingCounter;  // Ping counter for connection tracking
        };

        if (size != sizeof(GpsEspNowPacket)) {
          ESP_LOGW("espnow", "Received unexpected packet size: %d", size);
          lv_led_off(id(lv_led_7));  // Turn off LED on error
          return;
        }
        
        GpsEspNowPacket packet;
        memcpy(&packet, data, sizeof(GpsEspNowPacket));
        
        ESP_LOGI("espnow", "Ping received #%u from sender", packet.pingCounter);
        
        id(gps_connection_status).publish_state("Connected");

        // Publish to Home Assistant Sensors
        id(gps_lat).publish_state(packet.lat);
        id(gps_lon).publish_state(packet.lon);
        id(gps_alt).publish_state(packet.alt);
        id(gps_speed).publish_state(packet.speed);
        id(gps_heading).publish_state(packet.heading);
        id(gps_sats).publish_state(packet.sats);
        id(gps_sats_visible).publish_state(packet.satsVisible);
        id(gps_local_time).publish_state(packet.localTime);

        // Determine Fix Status
        std::string status = "Unknown";
        if (packet.fixType == 0) status = "No Fix";
        else if (packet.fixType == 1) status = "Dead Reckoning";
        else if (packet.fixType == 2) status = "2D Fix";
        else if (packet.fixType == 3) status = "3D Fix";
        id(gps_fix_status).publish_state(status);
        
        // Update LVGL Display
        char final_buf[64];

        snprintf(final_buf, sizeof(final_buf), "%.5f", packet.lat);
        lv_label_set_text(id(lat_value), final_buf);

        snprintf(final_buf, sizeof(final_buf), "%.5f", packet.lon);
        lv_label_set_text(id(lon_value), final_buf);

        snprintf(final_buf, sizeof(final_buf), "%.1f m", packet.alt);
        lv_label_set_text(id(alt_value), final_buf);

        lv_label_set_text(id(lbl_time), packet.localTime);
        
        // Dynamic bar range
        int current_sats = packet.sats;
        int visible_sats = packet.satsVisible;
        int max_sats = (int)id(gps_max_sats).state;
        
        if (visible_sats > max_sats) {
          max_sats = visible_sats;
          id(gps_max_sats).publish_state(max_sats);
        }
        
        // Update all satellite bars on all pages
        lv_bar_set_range(id(lbl_sats_canvas1), 0, visible_sats > 0 ? visible_sats : max_sats);
        lv_bar_set_value(id(lbl_sats_canvas1), current_sats, LV_ANIM_OFF);
        lv_obj_invalidate(id(lbl_sats_canvas1));
        
        lv_bar_set_range(id(lbl_sats_canvas2), 0, visible_sats > 0 ? visible_sats : max_sats);
        lv_bar_set_value(id(lbl_sats_canvas2), current_sats, LV_ANIM_OFF);
        lv_obj_invalidate(id(lbl_sats_canvas2));
        
        // lv_bar_set_range(id(lbl_sats_canvas3), 0, visible_sats > 0 ? visible_sats : max_sats);
        // lv_bar_set_value(id(lbl_sats_canvas3), current_sats, LV_ANIM_OFF);
        // lv_obj_invalidate(id(lbl_sats_canvas3));
        
        // lv_bar_set_range(id(lbl_sats_canvas4), 0, visible_sats > 0 ? visible_sats : max_sats);
        // lv_bar_set_value(id(lbl_sats_canvas4), current_sats, LV_ANIM_OFF);
        // lv_obj_invalidate(id(lbl_sats_canvas4));

        // Update status on Home page (canvas_1)
        lv_label_set_text(id(lbl_status_canvas1), status.c_str());
        // Update status on Accuracy page (canvas_2)
        lv_label_set_text(id(lbl_status_canvas2), status.c_str());

        snprintf(final_buf, sizeof(final_buf), "%d/%d", packet.sats, packet.satsVisible);
        // Update satellite status on Home page (canvas_1)
        lv_label_set_text(id(sat_status_canvas1), final_buf);
        // Update satellite status on Accuracy page (canvas_2)
        lv_label_set_text(id(sat_status_canvas2), final_buf);

        // Accuracy page
        snprintf(final_buf, sizeof(final_buf), "%.1f m", packet.hAcc);
        lv_label_set_text(id(value_hacc), final_buf);

        snprintf(final_buf, sizeof(final_buf), "%.1f m", packet.vAcc);
        lv_label_set_text(id(value_vacc), final_buf);

        const char* directions[] = {"N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE", 
                                     "S", "SSW", "SW", "WSW", "W", "WNW", "NW", "NNW"};
        int dir_index = (int)((packet.heading + 11.25) / 22.5) % 16;
        snprintf(final_buf, sizeof(final_buf), "%.0f° %s", packet.heading, directions[dir_index]);
        // lv_label_set_text(id(value_hdg), final_buf); // Widget not defined in lvgl section
        // lv_label_set_text(id(lbl_heading_speed), final_buf); // Widget not defined in lvgl section

        snprintf(final_buf, sizeof(final_buf), "%.2f", packet.hdop);
        lv_label_set_text(id(val_hdop), final_buf);

        snprintf(final_buf, sizeof(final_buf), "%.2f", packet.pdop);
        lv_label_set_text(id(val_pdop), final_buf);

        snprintf(final_buf, sizeof(final_buf), "%.2f", packet.vdop);
        lv_label_set_text(id(val_vdop), final_buf);

        // Speed (m/s to mph)
        float speed_mph = packet.speed * 2.23694;
        snprintf(final_buf, sizeof(final_buf), "%.1f", speed_mph);
        lv_label_set_text(id(val_speed), final_buf);
        // lv_bar_set_value(id(bar_speed), (int)speed_mph, LV_ANIM_OFF); // Widget not defined in lvgl section

        // Station IP
        uint8_t ip_bytes[4];
        ip_bytes[0] = (packet.stationIp >> 0) & 0xFF;
        ip_bytes[1] = (packet.stationIp >> 8) & 0xFF;
        ip_bytes[2] = (packet.stationIp >> 16) & 0xFF;
        ip_bytes[3] = (packet.stationIp >> 24) & 0xFF;
        
        snprintf(final_buf, sizeof(final_buf), "%d.%d.%d.%d", ip_bytes[0], ip_bytes[1], ip_bytes[2], ip_bytes[3]);
        std::string ip_str(final_buf);
        id(gps_station_ip).publish_state(ip_str);
        lv_label_set_text(id(value_gps_ip), final_buf);
        
        ESP_LOGI("espnow", "Ping received #%u from sender", packet.pingCounter);
        
        // Store ping counter for pong response
        id(last_ping_counter) = packet.pingCounter;
    
    # Send pong response back to sender
    - espnow.send:
        address: !lambda |-
          std::array<uint8_t, 6> addr;
          std::copy(info.src_addr, info.src_addr + 6, addr.begin());
          return addr;
        data: !lambda |-
          struct __attribute__((packed)) PongPacket {
            uint32_t pingCounter;
          };
          PongPacket pong;
          pong.pingCounter = id(last_ping_counter);
          
          ESP_LOGI("espnow", "Sending pong response for ping #%u", pong.pingCounter);
          
          return std::vector<uint8_t>((uint8_t*)&pong, (uint8_t*)&pong + sizeof(PongPacket));
        id: espnow_component
        wait_for_sent: true
        continue_on_error: true
    
    # Turn off LED after configurable duration
    - delay: !lambda "return id(led_blink_duration).state;"
    - lambda: |-
        lv_led_off(id(lv_led_7));

# =========================================================================
#  GLOBALS
# =========================================================================
globals:
  - id: last_ping_counter
    type: uint32_t
    restore_value: no
    initial_value: '0'
  
  - id: last_activity_time
    type: uint32_t
    restore_value: no
    initial_value: '0'
  
  - id: display_sleeping
    type: bool
    restore_value: no
    initial_value: 'false'

# =========================================================================
#  SENSORS
# =========================================================================
sensor:
  - platform: template
    id: gps_lat
    name: "GPS Latitude"
    accuracy_decimals: 7
    internal: true

  - platform: template
    id: gps_lon
    name: "GPS Longitude"
    accuracy_decimals: 7
    internal: true

  - platform: template
    id: gps_alt
    name: "GPS Altitude"
    unit_of_measurement: "m"
    accuracy_decimals: 1
    internal: true

  - platform: template
    id: gps_speed
    name: "GPS Speed"
    unit_of_measurement: "m/s"
    accuracy_decimals: 1
    internal: true

  - platform: template
    id: gps_heading
    name: "GPS Heading"
    unit_of_measurement: "°"
    accuracy_decimals: 0
    internal: true

  - platform: template
    id: gps_sats
    name: "GPS Satellites"
    accuracy_decimals: 0
    internal: true

  - platform: template
    id: gps_sats_visible
    name: "GPS Satellites Visible"
    accuracy_decimals: 0
    internal: true

  - platform: wifi_signal
    name: "WiFi Signal"
    internal: true

  # Removed debug sensors to save resources
  # - platform: debug
  #   free:
  #     name: "Heap Free"
  #   block:
  #     name: "Heap Max Block"
  #   loop_time:
  #     name: "Loop Time"
  #   psram:
  #     name: "Free PSRAM"
  #   cpu_frequency:
  #     name: "CPU Frequency"

text_sensor:
  - platform: wifi_info
    mac_address:
      name: "ESP MAC Address"
    ip_address:
      name: "ESP IP Address"
      id: wifi_ip_address
      internal: true
      on_value:
        then:
          - lambda: |-
              lv_label_set_text(id(value_receiver_ip), x.c_str());

  - platform: template
    id: gps_local_time
    name: "GPS Local Time"
    internal: true

  - platform: template
    id: gps_fix_status
    name: "GPS Fix Status"
    internal: true
  
  - platform: template
    id: gps_station_ip
    name: "GPS Station IP"
    internal: true
  
  - platform: template
    id: gps_connection_status
    name: "GPS Connection Status"
    internal: true
  
  - platform: template
    id: wifi_mac_address
    name: "WiFi MAC Address"
    internal: false
  
  - platform: template
    id: espnow_mac_address
    name: "ESP-NOW MAC Address"
    internal: false

  # Removed debug text sensors to save resources
  # - platform: debug
  #   device:
  #     name: "Device Info"
  #   reset_reason:
  #     name: "Reset Reason"

number:
  - platform: template
    name: "Max Satellites History"
    id: gps_max_sats
    optimistic: true
    min_value: 10
    max_value: 100
    step: 1
    initial_value: 24
    restore_value: true
    mode: box
    internal: true

  - platform: template
    name: "Display Brightness"
    id: display_brightness
    min_value: 10
    max_value: 100
    step: 5
    initial_value: 100
    optimistic: true
    restore_value: true
    on_value:
      then:
        - lambda: 'id(amoled_display).set_brightness((x - 10) * 2.8333);'

  - platform: template
    name: "LED Blink Duration"
    id: led_blink_duration
    min_value: 100
    max_value: 2000
    step: 100
    initial_value: 500
    unit_of_measurement: "ms"
    optimistic: true
    restore_value: true
    mode: box
    internal: true

  - platform: template
    name: "Display Sleep Timeout"
    id: display_sleep_timeout
    min_value: 0
    max_value: 300
    step: 5
    initial_value: 30
    unit_of_measurement: "s"
    optimistic: true
    restore_value: true
    mode: box
    internal: false

select:
  - platform: template
    name: "Display Rotation"
    id: display_rotation
    options: ["0°", "90°", "180°", "270°", "0° Mirror", "90° Mirror", "180° Mirror", "270° Mirror"]
    initial_option: "0°" 
    optimistic: true
    restore_value: true
    on_value:
      then:
        - lambda: |-
            // Set display rotation
            auto rotation = esphome::display::DISPLAY_ROTATION_0_DEGREES;
            if (x == "0°" || x == "0° Mirror") rotation = esphome::display::DISPLAY_ROTATION_0_DEGREES;
            else if (x == "90°" || x == "90° Mirror") rotation = esphome::display::DISPLAY_ROTATION_90_DEGREES;
            else if (x == "180°" || x == "180° Mirror") rotation = esphome::display::DISPLAY_ROTATION_180_DEGREES;
            else if (x == "270°" || x == "270° Mirror") rotation = esphome::display::DISPLAY_ROTATION_270_DEGREES;
            id(amoled_display).set_rotation(rotation);
            
            // Set LVGL rotation
            auto disp = lv_disp_get_default();
            if (disp != nullptr) {
              lv_disp_rot_t lvgl_rot = LV_DISP_ROT_NONE;
              
              if (x == "0°") lvgl_rot = LV_DISP_ROT_NONE;
              else if (x == "90°") lvgl_rot = LV_DISP_ROT_90;
              else if (x == "180°") lvgl_rot = LV_DISP_ROT_180;
              else if (x == "270°") lvgl_rot = LV_DISP_ROT_270;
              else if (x == "0° Mirror") lvgl_rot = LV_DISP_ROT_NONE;
              else if (x == "90° Mirror") lvgl_rot = LV_DISP_ROT_90;
              else if (x == "180° Mirror") lvgl_rot = LV_DISP_ROT_180;
              else if (x == "270° Mirror") lvgl_rot = LV_DISP_ROT_270;
              
              lv_disp_set_rotation(disp, lvgl_rot);
              
              // Apply mirror effect for mirror options
              if (x.find("Mirror") != std::string::npos) {
                lv_obj_set_style_transform_angle(lv_scr_act(), 1800, 0);  // 180 degrees = flip
              }
              
              lv_obj_invalidate(lv_scr_act());
              ESP_LOGI("rotation", "Display rotation set to: %s", x.c_str());
            }

  - platform: template
    name: "Display Page"
    id: display_page
    options:
      - "Home"
      - "GPS Accuracy"
      - "Speed"
      - "Network Info"
    initial_option: "Home"
    optimistic: true
    restore_value: true
    on_value:
      then:
        - if:
            condition:
              lambda: 'return x == "Home";'
            then:
              - lvgl.page.show: canvas_1
        - if:
            condition:
              lambda: 'return x == "GPS Accuracy";'
            then:
              - lvgl.page.show: canvas_2
        - if:
            condition:
              lambda: 'return x == "Speed";'
            then:
              - lvgl.page.show: canvas_3
        - if:
            condition:
              lambda: 'return x == "Network Info";'
            then:
              - lvgl.page.show: canvas_4

# =============================================
# Touchscreen configuration
# =============================================
touchscreen:
  platform: ft5x06
  display: amoled_display
  address: 0x38
  i2c_id: i2c_1
  id: amoled_touchscreen
  interrupt_pin: GPIO21
  on_touch:
    - lambda: |-
        // Reset sleep timer
        id(last_activity_time) = millis();
        
        // Wake display if sleeping
        if (id(display_sleeping)) {
          id(display_sleeping) = false;
          float brightness = id(display_brightness).state;
          id(amoled_display).set_brightness((brightness - 10) * 2.8333);
          ESP_LOGI("sleep", "Display woken by touchscreen");
          return;  // Don't process touch on wake, just wake up
        }
        
        ESP_LOGI("cal", "x=%d, y=%d, x_raw=%d, y_raw=%0d",
          touch.x,
          touch.y,
          touch.x_raw,
          touch.y_raw
        );

# =============================================
# Display configuration
# =============================================
display:
  - platform: mipi_spi
    id: amoled_display
    brightness: 100
    bus_mode: quad
    dimensions: 
      width: 368
      height: 448
    model: WAVESHARE-ESP32-S3-TOUCH-AMOLED-1.75
    cs_pin: GPIO12
      
# =============================================
# LVGL
# =============================================
lvgl:
  pages:
    - id: canvas_1
      bg_color: 0x000000
      widgets:
        - label:
            id: lbl_lat
            x: 0
            y: 133
            width: 365
            height: 40
            text: "LATITUDE"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_36

        - label:
            id: lat_value
            x: 0
            y: 172
            width: 365
            height: 50
            text: "38.75814"
            text_color: 0xE10522
            text_align: CENTER
            long_mode: DOT
            text_font: atkinson_48

        - label:
            id: lbl_lon
            x: 0
            y: 242
            width: 365
            height: 40
            text: "LONGITUDE"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_36

        - label:
            id: lon_value
            x: 0
            y: 281
            width: 365
            height: 40
            text: "-00.00000"
            text_color: 0xE10522
            text_align: CENTER
            long_mode: DOT
            text_font: atkinson_48

        - label:
            id: lbl_alt
            x: 0
            y: 342
            width: 365
            height: 30
            text: "ALTTUDE"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_36

        - label:
            id: alt_value
            x: 0
            y: 372
            width: 365
            height: 40
            text: "000.0 m"
            text_color: 0xE10522
            text_align: CENTER
            long_mode: DOT
            text_font: atkinson_48

        - label:
            id: lbl_time
            x: 0
            y: 17
            width: 365
            height: 40
            text: "00:00:00"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_38

        - led:
            id: lv_led_7
            x: 320
            y: 23
            width: 30
            height: 30
            color: 0xFF0000
            brightness: 21%

        - label:
            id: lbl_status_canvas1
            x: 251
            y: 70
            text: "3D Fix"
            text_color: 0xE10522
            text_font: montserrat_30

        - label:
            id: sat_status_canvas1
            x: 0
            y: 70
            text: "00 / 00"
            text_color: 0xE10522
            text_align: AUTO
            long_mode: DOT
            text_font: montserrat_30

        - bar:
            id: lbl_sats_canvas1
            x: 0
            y: 0
            width: 368
            height: 8
            value: 50
            min_value: 0
            max_value: 100
            indicator:
              bg_color: 0xE10522
            bg_color: 0x300707

    - id: canvas_2
      bg_color: 0x000000
      widgets:
        - label:
            id: lbl_status_canvas2
            x: 251
            y: 19
            text: "3D Fix"
            text_color: 0xE10522
            text_font: montserrat_30

        - label:
            id: sat_status_canvas2
            x: 0
            y: 18
            text: "00 / 00"
            text_color: 0xE10522
            text_align: AUTO
            long_mode: DOT
            text_font: montserrat_30

        - bar:
            id: lbl_sats_canvas2
            x: 0
            y: 0
            width: 368
            height: 8
            value: 50
            min_value: 0
            max_value: 100
            indicator:
              bg_color: 0xE10522
            bg_color: 0x770313

        - label:
            id: lbl_hacc
            x: 51
            y: 320
            text: "H.Acc"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_16

        - label:
            id: lbl_vacc
            x: 250
            y: 320
            text: "V.Acc"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_16

        - label:
            id: value_hacc
            x: 26
            y: 360
            text: "00.0 m"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_30

        - label:
            id: value_vacc
            x: 230
            y: 360
            text: "0.0 m"
            text_color: 0xE10522
            text_align: CENTER
            long_mode: DOT
            text_font: montserrat_30

        - label:
            id: lbl_hdop
            x: 0
            y: 140
            text: "HDOP"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_30

        - label:
            id: lbl_pdop
            x: 251
            y: 140
            text: "PDOP"
            text_color: 0xE10522
            text_font: montserrat_30

        - label:
            id: lbl_vdop
            x: 128
            y: 140
            text: "VDOP"
            text_color: 0xE10522
            text_font: montserrat_30

        - label:
            id: val_hdop
            x: 13
            y: 200
            text: "0.00"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_30

        - label:
            id: val_pdop
            x: 263
            y: 200
            text: "0.00"
            text_color: 0xE10522
            text_font: montserrat_30

        - label:
            id: val_vdop
            x: 139
            y: 200
            text: "0.00"
            text_color: 0xE10522
            text_font: montserrat_30

    - id: canvas_3
      bg_color: 0x000000
      widgets:
        # - bar:
        #     id: lbl_sats_canvas3
        #     x: 0
        #     y: 0
        #     width: 368
        #     height: 8
        #     value: 50
        #     min_value: 0
        #     max_value: 100
        #     indicator:
        #       bg_color: 0xE10522
        #     bg_color: 0x770313

        - label:
            id: val_speed
            x: 80
            y: 150
            width: 200
            height: 140
            text: "0.0"
            text_color: 0xE10522
            text_align: CENTER
            long_mode: DOT
            text_font: roboto_60


        # - label:
        #     id: widget_1767665966686_mbh2qhf34
        #     x: 41
        #     y: 380
        #     text: "Speed (m/h)"
        #     text_color: 0xE10522
        #     long_mode: DOT
        #     text_font: montserrat_40

    - id: canvas_4
      bg_color: 0x000000
      widgets:
        - label:
            id: lv_label_5
            x: 67
            y: 100
            width: 230
            height: 40
            text: "GPS ESP32 IP"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_30

        - label:
            id: widget_1767674385203_oy223ujq2
            x: 67
            y: 260
            width: 230
            height: 40
            text: "This Device"
            text_color: 0xE10522
            text_align: CENTER
            text_font: montserrat_30

        - label:
            id: value_receiver_ip
            x: 20
            y: 300
            width: 320
            height: 60
            text: "192.168.1.100"
            text_color: 0xE10522
            text_align: CENTER
            text_font: atkinson_48

        - label:
            id: value_gps_ip
            x: 20
            y: 140
            width: 320
            height: 60
            text: "192.168.1.100"
            text_color: 0xE10522
            text_align: CENTER
            text_font: atkinson_48


  displays:
    - amoled_display
  touchscreens:
    - amoled_touchscreen


# =========================================================================
# FONTS
# =========================================================================
font:
  - file: "gfonts://Roboto"
    id: font_16
    size: 16
  - file: "gfonts://Roboto"
    id: font_20
    size: 20
  - file: "gfonts://Roboto"
    id: font_32
    size: 32
  - file: "gfonts://Montserrat"
    id: montserrat_16
    size: 16
  - file: "gfonts://Montserrat"
    id: montserrat_20
    size: 20
  - file: "gfonts://Montserrat"
    id: montserrat_24
    size: 24
  - file: "gfonts://Montserrat"
    id: montserrat_28
    size: 28
  - file: "gfonts://Montserrat"
    id: montserrat_30
    size: 30
  - file: "gfonts://Montserrat"
    id: montserrat_32
    size: 32
  - file: "gfonts://Montserrat"
    id: montserrat_36
    size: 36
  - file: "gfonts://Montserrat"
    id: montserrat_40
    size: 40
  - file: "https://github.com/googlefonts/atkinson-hyperlegible/raw/main/fonts/ttf/AtkinsonHyperlegible-Regular.ttf"
    id: atkinson_48
    size: 48
  - file: "https://raw.githubusercontent.com/openmaptiles/fonts/refs/heads/master/roboto/Roboto-Regular.ttf"
    id: roboto_60
    size: 60
  - file: "https://raw.githubusercontent.com/openmaptiles/fonts/refs/heads/master/roboto/Roboto-Regular.ttf"
    id: roboto_64
    size: 64
